{"version":3,"sources":["webpack://aegis-app/./src/domain/Galaxy.js","webpack://aegis-app/./src/domain/Planet.js","webpack://aegis-app/./src/domain/SolarSystem.js","webpack://aegis-app/./src/domain/check-payload.js","webpack://aegis-app/./src/domain/mixins.js","webpack://aegis-app/./src/domain/order.js","webpack://aegis-app/./src/domain/ports.js","webpack://aegis-app/./src/domain/query-engine.js","webpack://aegis-app/./src/domain/utils.js"],"names":["listSolarSystems","data","console","log","fetchRelatedDomainService","solarSystem","msg","fn","name","systemsInGalaxy","galaxyId","id","SOLARSYSTEMS","sendGalaticSignal","o","planetsInSolarSystem","list","options","filter","systems","receiveSolarSignal","sendSolarSignal","query","args","receiveGalacticSignal","checkPayload","key","payload","port","model","Object","keys","Error","desc","error","Array","isArray","map","k","reduce","p","c","find","then","latest","prevmodel","Symbol","validations","mixinType","pre","post","mixinSets","premixins","postmixins","processUpdate","changes","JSON","parse","stringify","updates","compose","values","updated","updateMixins","type","cb","mixinSet","Map","has","set","eventMask","update","create","onload","handleUpdateEvent","event","isUpdate","decrypted","decrypt","isObject","containsUpdates","changeList","length","every","util","validateModel","input","v","sort","a","b","order","apply","output","enableEvent","onUpdate","onCreate","onLoad","enabled","enableValidation","onCreateAndUpdate","onLoadAndCreate","onLoadAndUpdate","onAll","addValidation","config","some","warn","parseKeys","propKeys","flat","RegExp","test","encryptProperties","encryptProps","obj","encrypt","freezeProperties","preventUpdates","mutations","includes","requireProperties","requireProps","missing","hashPasswords","hashPwds","hash","internalPropList","allowProperties","rejectUnknownProps","allowList","concat","unknownProps","rejectUnknownProperties","RegEx","email","ipv4Address","ipv6Address","phone","creditCard","ssn","expr","val","_expr","evaluateUniqueness","propVal","compareVal","unique","encrypted","listSync","propKey","Validator","tests","isValid","regex","maxnum","maxlen","validateProperties","validate","invalid","updateProperties","updaters","updateProps","u","invokePort","func","execMethod","functionType","string","createMethod","withValidFormat","checkFormat","value","x","encryptPersonalInfo","GlobalMixins","orderStatus","orderTotal","orderNo","OrderStatus","PENDING","APPROVED","SHIPPING","COMPLETE","CANCELED","checkItem","orderItem","itemId","price","checkItems","orderItems","items","calcTotal","total","item","qty","itemCount","freezeOnApproval","finalStatus","status","freezeOnCompletion","requiredForGuest","customerId","requiredForApproval","requiredForCompletion","invalidStatusChange","from","to","invalidStatusChanges","statusChangeValid","i","orderTotalValid","recalcTotal","updateSignature","signatureRequired","readyToDelete","handleError","errMsg","emit","paymentCompleted","orderShipped","shipmentPayload","shipmentId","orderPicked","addressValidated","addressPayload","shippingAddress","paymentAuthorized","paymentStatus","refundPayment","verifyAddress","debug","validateAddress","verifyPayment","authorizePayment","authorizeOrder","paymentDeclined","verifyInventory","inventory","insufficient","inv","quantity","getCustomerOrder","customer","custInfo","firstName","info","saveShippingDetails","processPendingOrder","asyncPipe","OrderActions","autoCheckout","runOrderWorkflow","updateSync","pickOrder","trackShipment","trackingUpdate","undo","handleOrderEvent","eventType","needsSignature","logMessage","message","substring","time","Date","now","toJSON","toISOString","makeOrderFactory","dependencies","createOrder","lastName","billingAddress","creditCardNumber","shippingPriority","requireSignature","fibonacci","result","estimatedArrival","uuid","push","logEvent","index","indx","parseInt","NaN","lastIndexOf","l","freeze","approve","approvedOrder","logStateChange","cancel","canceledOrder","checkout","errorCallback","timeoutCallback","ports","adapterFn","returnInventory","returnShipment","logUndo","accountOrder","req","res","returnDelivery","cancelPayment","OrderError","code","cancelOrders","cancelOrdersTransform","Transform","objectMode","transform","chunk","_encoding","done","_id","writable","createWriteStream","serialize","approveOrders","approveOrdersTransform","trackAsyncContext","ctx","getContext","dur","startTime","Promise","resolve","setTimeout","metric","requestId","get","duration","context","customHttpStatus","testContainsMany","chat","runFibonacciJs","param","start","QeError","qeRunFibonacci","qeCustomHttpStatus","qeGetPublicIpAddressIn","qeGetPublicIpAddressOut","funcs","initVal","reduceRight","composeAsync","f","passwd","process","env","ENCRYPTION_PWD","algo","crypto","String","iv","Buffer","alloc","text","cipher","cipherText","decipher","digest","nanoid","makeArray","makeObject","prop","async","promise","ok","object","asObject","asArray"],"mappings":"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","file":"334.js","sourcesContent":["'use strict'\n\n/**\n * @type {import('./index').ModelSpecification}\n */\nexport async function listSolarSystems (data) {\n  console.log({ data })\n  const solarSystem = await this.fetchRelatedDomainService('SOLARSYSTEM')\n  console.log({\n    msg: 'result of',\n    fn: this.fetchRelatedDomainService.name,\n    solarSystem\n  })\n  return {\n    SOLARSYSTEMS: await solarSystem.systemsInGalaxy({ galaxyId: data.id })\n  }\n}\n\nexport async function sendGalaticSignal (data) {\n  console.log({\n    fn: sendGalaticSignal.name,\n    o: 'Galaxy',\n    msg: 'port function invoked',\n    data\n  })\n}\n","'use strict'\n\n/**\n * @type {import('./index').ModelSpecification}\n */\nexport async function planetsInSolarSystem (data) {\n  console.log({ data })\n  const systems = await this.list({\n    options: { filter: { galaxyId: data.id } }\n  })\n  console.log({ systems })\n  return systems\n}\n\nexport async function receiveSolarSignal (data) {\n  console.log({ fn: receiveSolarSignal.name, o: 'Planet' })\n}\n\nexport async function sendSolarSignal (data) {\n  console.log({ fn: sendSolarSignal.name, o: 'Planet' })\n}\n","'use strict'\n\n/**\n * @type {import('./index').ModelSpecification}\n */\nexport async function systemsInGalaxy (data) {\n  console.log({ data })\n  const systems = await this.list({\n    query: { galaxyId: data.galaxyId || data.args.galaxyId }\n  })\n  console.log({ systems })\n  return systems\n}\n\nexport async function receiveGalacticSignal (data) {\n  console.log({ fn: receiveGalacticSignal.name, o: 'SolarSystem' })\n}\n\nexport async function sendSolarSignal (data) {\n  console.log({ fn: sendSolarSignal.name, o: 'SolarSystem' })\n}\n","'use strict'\n\n/**\n * Check the payload for expected properties.\n * @param {string|string[]} key name of property or properties\n * @param {*} options\n * @param {*} payload\n * @param {*} port\n */\nexport default function checkPayload (\n  key,\n  options = {},\n  payload = {},\n  port = checkPayload.name\n) {\n  const { model } = options\n\n  if (!model || Object.keys(payload) < 1 || !key) {\n    throw new Error({\n      desc: 'model, payload, or key is missing',\n      model,\n      port,\n      error,\n      payload,\n      key\n    })\n  }\n\n  if (Array.isArray(key)) {\n    const keys = key.map(k => checkPayload(k, options, payload, port))\n\n    return keys.reduce((p, c) => ({ ...p, ...c }))\n  }\n\n  if (payload[key]) {\n    return { [key]: payload[key] }\n  }\n\n  if (model[key]) {\n    return { [key]: model[key] }\n  }\n\n  return model\n    .find()\n    .then(latest => ({ [key]: latest[key] }))\n    .catch(error => {\n      throw new Error('property is missing' + key, port, error, payload, model)\n    })\n}\n","'use strict'\n\nimport { hash, encrypt, decrypt, compose } from '../domain/utils'\nimport util from 'util'\n\n/**\n * Functional mixin created by `functionalMixinFactory`\n * @callback functionalMixin\n * @param {Object} o Object to compose\n * @returns {Object} Composed object\n */\n\n/**\n * Functional mixin factory - partial application - returns mixin function\n * @callback functionalMixinFactory\n * @param {*} mixinParams params for mixin function\n * @returns {functionalMixin}\n */\n\n/**\n * @typedef {import(\"../domain/index\").Model} Model\n */\n\n/**\n * Private key to access previous version of the model\n */\nexport const prevmodel = Symbol('prevModel')\n/**\n * private key to access validation config\n */\nexport const validations = Symbol('validations')\n/**\n * Process mixin pre or post update\n */\nexport const mixinType = {\n  pre: Symbol('pre'),\n  post: Symbol('post')\n}\n\n/**\n * Stored mixins - use private symbol as key to prevent overwrite\n */\nexport const mixinSets = {\n  [mixinType.pre]: Symbol('preUpdateMixins'),\n  [mixinType.post]: Symbol('postUpdateMixins')\n}\n\n/**\n * Set of pre mixins\n */\nconst premixins = mixinSets[mixinType.pre]\n/**\n * Set of post mixins\n */\nconst postmixins = mixinSets[mixinType.post]\n\n/**\n * Apply any pre and post mixins and return the result.\n * @deprecated\n * @param {*} model - current model\n * @param {*} changes - object containing changes\n * @returns {import('.').Model} updated model\n */\nexport function processUpdate (model, changes) {\n  changes[prevmodel] = JSON.parse(JSON.stringify(model)) // keep history\n\n  const updates = model[premixins]\n    ? compose(...model[premixins].values())(changes)\n    : changes\n\n  const updated = { ...model, ...updates }\n\n  return model[postmixins]\n    ? compose(...model[postmixins].values())(updated)\n    : updated\n}\n\n/**\n * @deprecated\n * Store mixins for execution on update\n * @param {mixinType} type\n * run before changes are applied or afterward\n * @param {*} o  Object containing changes to apply (pre)\n * or new object after changes have been applied (post)\n * @param {string} name `Function.name`\n * @param {functionalMixin} cb mixin function\n */\nexport function updateMixins (type, o, name, cb) {\n  if (!mixinSets[type]) {\n    throw new Error('invalid mixin type')\n  }\n\n  const mixinSet = o[mixinSets[type]] || new Map()\n\n  if (!mixinSet.has(name)) {\n    mixinSet.set(name, cb())\n\n    return {\n      ...o,\n      [mixinSets[type]]: mixinSet\n    }\n  }\n  return o\n}\n\n/**\n * bitmask for identifying events\n */\nconst eventMask = {\n  update: 1, //  0001 Update\n  create: 1 << 1, //  0010 Create\n  onload: 1 << 2 //  0100 Load\n}\n\nfunction handleUpdateEvent (model, updates, event) {\n  const isUpdate = eventMask.update & event\n  const decrypted = isUpdate ? model.decrypt() : {}\n  return {\n    ...model,\n    ...updates,\n    ...decrypted\n  }\n}\n\nfunction isObject (p) {\n  return p != null && typeof p === 'object'\n}\n\nfunction containsUpdates (model, changes, event) {\n  try {\n    if (!changes) return false\n    if (eventMask.update & event) {\n      const changeList = Object.keys(changes)\n      if (changeList.length < 1) return false\n\n      if (\n        changeList.every(\n          k => model[k] && util.isDeepStrictEqual(changes[k], model[k])\n        )\n      ) {\n        return false\n      }\n    }\n    return true\n  } catch (error) {\n    console.error({ fn: containsUpdates.name, error })\n  }\n  return false\n}\n\n/**\n * Run validation functions enabled for a given event.\n * @param {Model} model - the composed object\n * @param {*} changes - object containing changes\n * @param {Number} event - Indicates what event is occuring:\n * 1st bit turned on means update, 2nd bit create, 3rd load,\n * see {@link eventMask}.\n */\nexport function validateModel (model, changes, event) {\n  if (!model || !changes || !event) return {}\n  // if there are no changes, and the event is an update, return\n  if (!containsUpdates(model, changes, event)) {\n    return model\n  }\n\n  // keep a history of the last saved model\n  const input = {\n    ...changes,\n    [prevmodel]: JSON.parse(JSON.stringify(model || {}))\n  }\n\n  // Validate just the input data\n  const updates = model[validations]\n    .filter(v => v.input & event)\n    .sort((a, b) => a.order - b.order)\n    .map(v => model[v.name].apply(input))\n    .reduce((p, c) => ({ ...p, ...c }), input)\n\n  const updated = { ...model, ...updates }\n\n  // Validate the updated model\n  return updated[validations]\n    .filter(v => v.output & event)\n    .sort((a, b) => a.order - b.order)\n    .map(v => updated[v.name]())\n    .reduce((p, c) => ({ ...p, ...c }), updated)\n}\n\n/**\n * Enable validation to run on specific events.\n * @param {boolean} onUpdate - whether or not to run the validation on update.\n * Defaults to `true`.\n * @param {boolean} onCreate - whether or not to run the validation on create.\n * Defaults to `true`.\n * @param {boolean} onLoad - whether or not to run the validation when\n * the object is being loaded into memory after being deserialized.\n * Defaults to `false`.\n */\nfunction enableEvent ({ onUpdate = true, onCreate = true, onLoad = false }) {\n  let enabled = 0\n\n  if (onUpdate) {\n    enabled |= eventMask.update\n  }\n  if (onCreate) {\n    enabled |= eventMask.create\n  }\n  if (onLoad) {\n    enabled |= eventMask.onload\n  }\n  return enabled\n}\n\n/**\n * Specify when validations run.\n */\nconst enableValidation = (() => {\n  return {\n    /**\n     * Validation runs on update.\n     */\n    onUpdate: enableEvent({\n      onUpdate: true,\n      onCreate: false,\n      onLoad: false\n    }),\n    /**\n     * Validation runs on create.\n     */\n    onCreate: enableEvent({\n      onUpdate: false,\n      onCreate: true,\n      onLoad: false\n    }),\n    /**\n     * Validation runs on both create and update.\n     */\n    onCreateAndUpdate: enableEvent({\n      onUpdate: true,\n      onCreate: true,\n      onLoad: false\n    }),\n    /**\n     * Validation runs on load.\n     */\n    onLoad: enableEvent({\n      onUpdate: false,\n      onCreate: false,\n      onLoad: true\n    }),\n    /**\n     * Validation runs on load and create.\n     */\n    onLoadAndCreate: enableEvent({\n      onUpdate: false,\n      onCreate: true,\n      onLoad: true\n    }),\n    /**\n     * Validation runs on load and create.\n     */\n    onLoadAndUpdate: enableEvent({\n      onUpdate: true,\n      onCreate: false,\n      onLoad: true\n    }),\n    /**\n     * Validation runs on all events.\n     */\n    onAll: enableEvent({\n      onUpdate: true,\n      onCreate: true,\n      onLoad: true\n    })\n  }\n})()\n\n/**\n * Add a validation function to be called for a given event.\n * @typedef {object} validationConfig\n * @property {*} o - the composed object\n * @property {string} name - name of function to run\n * @property {number} input - \"input\" validations run against\n * the data passed by the caller in the request. Use `enableValidation`\n * to provide a value for this param.\n * @property {number} output - \"output\" functions run against the\n * model after the changes have been applied.\n * @property {number} order - order in which validation runs\n * @param {validationConfig} param0\n */\nfunction addValidation ({ model, name, input = 0, output = 0, order = 50 }) {\n  const config = model[validations] || []\n\n  if (config.some(v => v.name === name)) {\n    console.warn('duplicate validation name', name)\n    return model\n  }\n\n  return {\n    ...model,\n    validateModel,\n    [validations]: [...config, { name, input, output, order }]\n  }\n}\n\n/**\n * Resolve keys:\n * If the value includes an array, flatten it, then for each element:\n * If the value is \"*\", return all keys of the object.\n * If the value is a function, execute it to get a dynamic key or key list.\n * If the value is a RegExp, test it to get dynamic key list.\n * If any of the above produce an array of keys, flatten it.\n * @param {*} o - Object to compose\n * @param  {Array<string | function(*):string>} propKeys -\n * Names (or functions that return names) of properties\n * @returns {string[]} list of (resolved) property keys\n */\nfunction parseKeys (o, ...propKeys) {\n  if (!propKeys || !o) return null\n  const keys = propKeys.flat().map(function (k) {\n    if (typeof k === 'function') return k(o)\n    if (k instanceof RegExp) return Object.keys(o).filter(key => k.test(key))\n    if (k === '*') return Object.keys(o)\n    return k\n  })\n  return keys.flat()\n}\n\n/**\n * Encrypt properties. Properties remain encrypted indefinitely, and\n * must be explicitly decrypted as needed, e.g. reading values in memory,\n * from storage, serializing and sending to an external system.\n * @param  {Array<string | function(*):string>} propKeys -\n * Names (or functions that return names) of properties to encrypt\n * @returns {functionalMixin} mixin function\n */\nexport const encryptProperties = (...propKeys) => o => {\n  const keys = parseKeys(o, ...propKeys)\n\n  const encryptProps = obj => {\n    return keys\n      .map(key => (obj[key] ? { [key]: encrypt(obj[key]) } : {}))\n      .reduce((p, c) => ({ ...p, ...c }))\n  }\n\n  return {\n    encryptProperties () {\n      return encryptProps(this)\n    },\n\n    ...addValidation({\n      model: o,\n      name: encryptProperties.name,\n      input: enableValidation.onUpdate,\n      output: enableValidation.onCreate,\n      order: 100\n    }),\n\n    decrypt () {\n      return keys\n        .map(key => (this[key] ? { [key]: decrypt(this[key]) } : {}))\n        .reduce((p, c) => ({ ...p, ...c }), {})\n    }\n  }\n}\n\n/**\n * Prevent properties from being modified.\n * Accepts a property name or a function that returns a property name.\n * @param  {Array<string | function(*):string | RegExp>} propKeys - names of properties to freeze\n */\nexport const freezeProperties = (...propKeys) => o => {\n  const preventUpdates = obj => {\n    const keys = parseKeys(obj, ...propKeys)\n\n    const mutations = Object.keys(obj).filter(key => keys.includes(key))\n    if (mutations?.length > 0) {\n      throw new Error(`cannot update readonly properties: ${mutations}`)\n    }\n  }\n\n  return {\n    freezeProperties () {\n      preventUpdates(this)\n    },\n\n    ...addValidation({\n      model: o,\n      name: freezeProperties.name,\n      input: enableValidation.onUpdate,\n      order: 20\n    })\n  }\n}\n\n/**\n * Enforce required fields.\n * @param {Array<string | function(*):string | RegExp>} propKeys -\n * required property key names - can be a function or regex\n * that returns the property key names\n */\nexport const requireProperties = (...propKeys) => o => {\n  const keys = parseKeys(o, ...propKeys)\n\n  function requireProps (obj) {\n    const missing = keys.filter(key => key && !obj[key])\n    if (missing?.length > 0) {\n      throw new Error(`missing required properties: ${missing}`)\n    }\n  }\n  return {\n    requireProperties () {\n      requireProps(this)\n    },\n\n    ...addValidation({\n      model: o,\n      name: requireProperties.name,\n      output: enableValidation.onCreateAndUpdate,\n      order: 90\n    })\n  }\n}\n\n/**\n * Hash passwords.\n * @param {*} hash hash algorithm\n * @param  {Array<string | function(*):string | RegExp>} propKeys name of password props\n */\nexport const hashPasswords = (...propKeys) => o => {\n  const keys = parseKeys(o, ...propKeys)\n\n  function hashPwds (obj) {\n    return keys\n      .map(key => (obj[key] ? { [key]: hash(obj[key]) } : {}))\n      .reduce((p, c) => ({ ...p, ...c }))\n  }\n\n  return {\n    hashPasswords () {\n      return hashPwds(this)\n    },\n\n    ...addValidation({\n      model: o,\n      name: hashPasswords.name,\n      input: enableValidation.onUpdate,\n      output: enableValidation.onCreate,\n      order: 100\n    })\n  }\n}\n\nconst internalPropList = []\n\n/**\n * Reject unknown properties in user input. Allow only approved keys.\n * @param  {...any} propKeys\n */\nexport const allowProperties = (...propKeys) => o => {\n  function rejectUnknownProps () {\n    const keys = parseKeys(o, ...propKeys)\n    const allowList = keys.concat(internalPropList)\n\n    const unknownProps = Object.keys(o).filter(key => !allowList.includes(key))\n\n    if (unknownProps?.length > 0) {\n      throw new Error(`invalid properties: ${unknownProps}`)\n    }\n  }\n\n  return {\n    rejectUnknownProperties () {\n      return rejectUnknownProps(this)\n    },\n\n    ...addValidation({\n      model: o,\n      name: rejectUnknownProps.name,\n      input: enableValidation.onUpdate,\n      order: 10\n    })\n  }\n}\n\n/**\n * Test regular expressions\n */\nexport const RegEx = {\n  email: /^(.+)@(.+){2,}\\.(.+){2,}$/,\n  ipv4Address: /^([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])$/,\n  ipv6Address: /^((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*::((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*|((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4})){7}$/,\n  phone: /^[1-9]\\d{2}-\\d{3}-\\d{4}/,\n  creditCard: /^(?:4[0-9]{12}(?:[0-9]{3})?|[25][1-7][0-9]{14}|6(?:011|5[0-9][0-9])[0-9]{12}|3[47][0-9]{13}|3(?:0[0-5]|[68][0-9])[0-9]{11}|(?:2131|1800|35\\d{3})\\d{11})$/,\n  ssn: /^(?!666|000|9\\\\d{2})\\\\d{3}-(?!00)\\\\d{2}-(?!0{4})\\\\d{4}$/,\n  /**\n   * Allow caller to pass a keyword that refers to one of the regex above\n   * @param {regexType} expr\n   * @param {*} val\n   */\n  test (expr, val) {\n    const _expr =\n      Object.keys(this).includes(expr) && this[expr] instanceof RegExp\n        ? this[expr]\n        : expr\n    return _expr.test(val)\n  }\n}\n\n/**\n * @callback isValid\n * @param {Object} o - the property owner\n * @param {*} propVal - the property value\n * @returns {boolean} - true if valid\n *\n * @typedef {'email'|'phone'|'ipv4Address'|'ipv6Address'|'creditCard'|'ssn'|RegExp} regexType\n *\n * @typedef {{\n *  propKey:string,\n *  isValid?:isValid,\n *  values?:any[],\n *  regex?:regexType,\n *  maxlen?:number\n *  maxnum?:numbertp\n *  typeof?:string\n *  unique?:{ encrypted:boolean }\n * }} validation\n */\n\nfunction evaluateUniqueness (v, o, propVal) {\n  const compareVal = v.unique.encrypted ? encrypt(propVal) : propVal\n  return o.listSync({ [v.propKey]: compareVal }).length < 1\n}\n\n/**\n * Run validation tests\n */\nconst Validator = {\n  tests: {\n    isValid: (v, o, propVal) => v.isValid(o, propVal),\n    values: (v, o, propVal) => v.values.includes(propVal),\n    regex: (v, o, propVal) => RegEx.test(v.regex, propVal),\n    typeof: (v, o, propVal) => v.typeof === typeof propVal,\n    maxnum: (v, o, propVal) => v.maxnum + 1 > propVal,\n    maxlen: (v, o, propVal) => v.maxlen + 1 > propVal.length,\n    unique: (v, o, propVal) => evaluateUniqueness(v, o, propVal)\n  },\n  /**\n   * Returns true if tests pass.\n   * @param {validation} v validation config\n   * @param {Object} o object to compose\n   * @param {*} propVal value of property to validate\n   * @returns {boolean} true if tests pass\n   */\n  isValid (v, o, propVal) {\n    return Object.keys(this.tests).every(key => {\n      if (v[key]) {\n        // the test `key` is specified, run it\n        return this.tests[key](v, o, propVal)\n      }\n      return true\n    })\n  }\n}\n\n/**\n * Verify a property value is a member of a list,\n * is unique within a set of model instances,\n * is of a certain length, size or type,\n * matches a regular expression,\n * or satisfies a custom validation function.\n * @param {validation[]} validations\n */\nexport const validateProperties = validations => o => {\n  function validate (obj) {\n    const invalid = validations.filter(v => {\n      const propVal = obj[v.propKey]\n\n      if (!propVal) {\n        return false\n      }\n      return !Validator.isValid(v, obj, propVal)\n    })\n\n    if (invalid?.length > 0) {\n      throw new Error(`invalid value for ${[...invalid.map(v => v.propKey)]}`)\n    }\n  }\n\n  return {\n    validateProperties () {\n      validate(this)\n    },\n\n    ...addValidation({\n      model: o,\n      name: validateProperties.name,\n      input: enableValidation.onUpdate,\n      output: enableValidation.onCreate,\n      order: 50\n    })\n  }\n}\n\n/**\n * @callback updaterFn\n * @param {Object} o\n * @param  {*} propVal\n * @returns {Object} object with updated properties\n *\n * @typedef {{\n * propKey: string,\n * update: updaterFn\n * }} updater\n */\n\n/**\n * Respond to property updates by updating addtional (dependent) properties as needed.\n * @param {updater[]} updaters\n */\nexport const updateProperties = updaters => o => {\n  function updateProps (obj) {\n    const updates = updaters.filter(u => obj[u.propKey])\n\n    if (updates?.length > 0) {\n      return updates\n        .map(u => u.update(o, obj[u.propKey]))\n        .reduce((p, c) => ({ ...p, ...c }))\n    }\n  }\n\n  return {\n    updateProperties () {\n      return updateProps(this)\n    },\n\n    ...addValidation({\n      model: o,\n      name: updateProperties.name,\n      output: enableValidation.onUpdate,\n      order: 30\n    })\n  }\n}\n\n/**\n * Set a validation that invokes a port. The port must be configured\n * in the `ModelSpecification`.\n * @param {string} fn - name of port (as it appears in the ModelSpec)\n * @param {boolean} onCreate - invoke on create\n * @param {boolean} onUpdate - invoke on update\n * @param  {...any} args - pass arguments\n */\nexport const invokePort = (fn, onCreate, onUpdate, ...args) => async o => {\n  return {\n    ...o,\n    invokePort () {\n      console.log({ func: 'invokePort', fn, args })\n      return this[fn](...args).then(o => o)\n    },\n\n    ...addValidation({\n      model: o,\n      name: 'invokePort',\n      output: enableValidation.onUpdate,\n      order: 85\n    })\n  }\n}\n\n/**\n * Set a validation that calls a model method or provided function.\n * @param {string|function(Model, ...any):Promise<any>} fn - callback function\n * or name of method to executee\n * @param {boolean} onCreate - invoke on create\n * @param {boolean} onUpdate - invoke on update\n * @param  {...any} args - pass arguments to the method/function\n * @return {Model}\n */\nexport const execMethod = (fn, onCreate, onUpdate, ...args) => async o => {\n  const functionType = {\n    function: (fn, obj, ...args) => fn(obj, ...args).then(o => o),\n    string: (fn, obj, ...args) => obj[fn](...args).then(o => o)\n  }\n\n  return {\n    ...o,\n    async execMethod () {\n      const model = await functionType[typeof fn](fn, this, ...args)\n      return model\n    },\n\n    ...addValidation({\n      model: o,\n      name: 'execMethod',\n      output: enableValidation.onUpdate,\n      order: 40\n    })\n  }\n}\n\n/**\n * Create a method on a model.\n * @param {*} fn\n * @param  {...any} args\n */\nexport const createMethod = (fn, ...args) => o => {\n  return {\n    ...o,\n    [fn.name]: () => fn(...args)\n  }\n}\n\n/**\n * Check the value of the property before returning its key.\n * @param {*} propKey\n * @param {regexType} expr\n * @returns {function(any):any} dynamic property func\n */\nexport const withValidFormat = (propKey, expr) => o => {\n  if (o[propKey] && !RegEx.test(expr, o[propKey])) {\n    throw new Error(`invalid ${propKey}`)\n  }\n  return propKey\n}\n\n/**\n *\n * @param {string} value\n * @param {regexType} expr\n */\nexport const checkFormat = (value, expr) => {\n  if (value && !RegEx.test(expr, value)) {\n    const x = expr instanceof RegExp ? value : expr\n    throw new Error(`${x} invalid`)\n  }\n}\n\n/**\n * Implement GDPR encryption requirement across models\n */\nexport const encryptPersonalInfo = encryptProperties(\n  /^last.*Name$|^surname$|^family.*Name$/i,\n  /^shipping.*Address$/i,\n  /^billing.*Address$/i,\n  /^home.*Address$/i,\n  /email|e-mail/i,\n  /^phone$|^home.*phone$/i,\n  /^mobile$|^mobile.*number$|^cell.*number$/i,\n  /^credit.*Card/i,\n  /^cvv$/i,\n  /^ssn$|^socialSecurity/i,\n  /^encrypted/i\n)\n\n/**\n * Global mixins\n */\nconst GlobalMixins = [encryptPersonalInfo]\n\nexport default GlobalMixins\n","'use strict'\n\nimport { prevmodel } from './mixins'\nimport { asyncPipe } from '../domain/utils'\nimport checkPayload from './check-payload'\nimport { Transform } from 'stream'\n\n/** @typedef { import('../domain/index.js').ModelSpecification} ModelSpecification */\n/** @typedef {string|RegExp} topic*/\n/** @typedef {function(string)} eventCallback*/\n/** @typedef {import('../adapters/index').adapterFunction} adapterFunction*/\n/** @typedef {string} id */\n/** @typedef {import(\"./customer\").Customer} Customer */\n/** @typedef {function(Order)} undoFunction */\n/**\n * @callback logMessageFn\n * @param {object|string} message\n * @param {logType} [type]\n *\n */\n\n/** @typedef {'first'|'last'|'lastStateChange'|'stateChange'|'error'|'undo'} logType */\n\n/**\n * @typedef readLogType\n * @property {number} index\n * @property  {logType} type\n */\n\n/**\n * @typedef {{\n *  itemId: string,\n *  price: number,\n *  qty?: number\n * }} orderItemType\n */\n\n/**\n * @callback relationFunction\n * @property {...args}\n * @returns {Promise<Model>}\n * } relationFunction\n */\n\n/**\n *  @typedef {Object} Order The Order Service\n * @property {function(topic,eventCallback)} listen - listen for events\n * @property {import('../adapters/event-adapter').notifyType} notify\n * @property {adapterFunction} validateAddress - returns valid address or throws exception\n * @property {adapterFunction} completePayment - completes payment for an authorized charge\n * @property {adapterFunction} verifyDelivery - verify the order was received by the customer\n * @property {adapterFunction} trackShipment\n * @property {adapterFunction} refundPayment\n * @property {relationFunction} inventory - reserve inventory items\n * @property {adapterFunction} undo - undo all transactions up to this point\n * @property {function():Promise<Order>} pickOrder - pick items from warehouse and prepare for shipment\n * @property {adapterFunction} authorizePayment - verify payment, i.e. reserve the balance due\n * @property {import('../adapters/shipping-adapter').shipOrder} shipOrder -\n * calls shipping service to print label and request delivery\n * @property {function(Order):Promise<void>} save - saves order\n * @property {function():Promise<Order>} find - finds order\n * @property {string} shippingAddress\n * @property {string} orderNo = the order number\n * @property {string} trackingId - id given by tracking status for this `orderNo`\n * @property {function():Order} decrypt - decrypts sensitive properties\n * @property {function({key1:any,keyN:any}, boolean):Promise<Order>} update - update the order,\n * set the second arg to false to turn off validation.\n * @property {'PENDING'|'APPROVED'|'SHIPPING'|'CANCELED'|'COMPLETED'} orderStatus\n * @property {function(...args):Promise<import(\"../domain/index\").Model>} customer - retrieves related customer object,\n * or if args are provided, creates a new customer object, using the provided args as the input.\n * @property {function(string,Order):Promise} emit - broadcast domain event\n * @property {function():boolean} paymentAccepted - payment approved and funds reserved\n * @property {function():boolean} autoCheckout - whether or not to immediately submit the order\n * @property {boolean} saveShippingDetails save shipping and payment details in a new customer record\n * @property {{itemId:string,price:number,qty:number}[]} orderItems\n * @property {Symbol} customerId {@link Customer}\n * @property {logMessageFn} logEvent\n * @property {logMessageFn} logError\n * @property {logMessageFn} logUndo\n * @property {logMessageFn} logStateChange\n * @property {readMessageFn} readLog\n */\n\nconst orderStatus = 'orderStatus'\nconst orderTotal = 'orderTotal'\nconst orderNo = 'orderNo'\n\nexport const OrderStatus = {\n  PENDING: 'PENDING',\n  APPROVED: 'APPROVED',\n  SHIPPING: 'SHIPPING',\n  COMPLETE: 'COMPLETE',\n  CANCELED: 'CANCELED'\n}\n\n/**\n *\n * @param {orderItemType} orderItem\n * @returns {boolean} true if item is valid\n */\nexport const checkItem = function (orderItem) {\n  return (\n    typeof orderItem.itemId === 'string' && typeof orderItem.price === 'number'\n  )\n}\n\n/**\n * @param {orderItemType[]} orderItems\n */\nexport const checkItems = function (orderItems) {\n  if (!orderItems || orderItems.length < 1) {\n    throw new Error('order contains no items')\n  }\n  const items = Array.isArray(orderItems) ? orderItems : [orderItems]\n\n  if (items.length > 0 && items.every(checkItem)) {\n    return items\n  }\n  throw new Error('order items invalid', { items })\n}\n\n/**\n * Calculate order total\n * @param {orderItemType[]} orderItems\n */\nexport const calcTotal = function (orderItems) {\n  const items = checkItems(orderItems)\n\n  return items.reduce((total, item) => {\n    const qty = item.qty || 1\n    return (total += item.price * qty)\n  }, 0)\n}\n\n/**\n * @param {orderItemType[]} orderItems\n * @returns {number} number of items\n */\nexport const itemCount = function (orderItems) {\n  return orderItems.reduce((total, item) => (total += item.qty || 1))\n}\n\n/**\n * No changes to `propKey` properties once the order is approved\n * @param {*} o - the order\n * @param {*} propKey\n * @returns {string | null} the key or `null`\n */\nexport const freezeOnApproval = propKey => o =>\n  o.orderStatus && o.orderStatus !== OrderStatus.PENDING ? propKey : null\n\nconst finalStatus = status =>\n  [OrderStatus.COMPLETE, OrderStatus.CANCELED].includes(status)\n\n/**\n * No changes to `propKey` once order is complete or canceled\n * @param {*} o - the order\n * @param {*} propKey\n * @returns {string | null} the key or `null`\n */\nexport const freezeOnCompletion = propKey => o =>\n  finalStatus(o.orderStatus) ? null : propKey\n\n/**\n * If not a registered customer, provide shipping & payment details.\n * @param {*} o\n * @param {*} propKey\n * @returns {string | void} the key or `void`\n */\nexport const requiredForGuest = propKey => o => (o.customerId ? null : propKey)\n\n/**\n * Value required to approve order.\n * @param {*} propKey\n */\nexport const requiredForApproval = propKey => o =>\n  o.orderStatus === OrderStatus.APPROVED ? propKey : null\n\n/**\n * Value required to complete order\n * @param {object} o\n * @param {string | string[]} propKey these props are required to comlete the order\n * @returns {string | void} the key or `void`\n */\nexport const requiredForCompletion = propKey => o =>\n  o.orderStatus === OrderStatus.COMPLETE ? propKey : null\n\n/**\n *\n * @param {enum} from\n * @param {enum} to\n * @returns\n */\nconst invalidStatusChange = (from, to) => (o, propVal) =>\n  propVal === to && o[prevmodel].orderStatus === from\n\nconst invalidStatusChanges = [\n  // Can't change back to pending once approved\n  invalidStatusChange(OrderStatus.APPROVED, OrderStatus.PENDING),\n  // Can't change back to pending once shipped\n  invalidStatusChange(OrderStatus.SHIPPING, OrderStatus.PENDING),\n  // Can't change back to approved once shipped\n  invalidStatusChange(OrderStatus.SHIPPING, OrderStatus.APPROVED),\n  // Can't change directly to shipping from pending\n  invalidStatusChange(OrderStatus.PENDING, OrderStatus.SHIPPING),\n  // Can't change directly to complete from pending\n  invalidStatusChange(OrderStatus.PENDING, OrderStatus.COMPLETE),\n  // Can't change final status\n  invalidStatusChange(OrderStatus.COMPLETE, OrderStatus.PENDING),\n  invalidStatusChange(OrderStatus.COMPLETE, OrderStatus.SHIPPING),\n  invalidStatusChange(OrderStatus.COMPLETE, OrderStatus.APPROVED),\n  invalidStatusChange(OrderStatus.COMPLETE, OrderStatus.CANCELED),\n  // Can't change final status\n  invalidStatusChange(OrderStatus.CANCELED, OrderStatus.PENDING),\n  invalidStatusChange(OrderStatus.CANCELED, OrderStatus.SHIPPING),\n  invalidStatusChange(OrderStatus.CANCELED, OrderStatus.APPROVED),\n  invalidStatusChange(OrderStatus.CANCELED, OrderStatus.COMPLETE)\n]\n\n/**\n * Check that status changes are valid\n */\nexport const statusChangeValid = (o, propVal) => {\n  if (invalidStatusChanges.some(i => i(o, propVal))) {\n    throw new Error('invalid status change')\n  }\n  return true\n}\n\n/**\n *\n * @param {*} o\n * @param {*} propVal\n */\nexport const orderTotalValid = (o, propVal) =>\n  calcTotal(o.orderItems) === propVal\n\n/**\n * Recalculate order total\n * @param {object} o - the object (order)\n * @param {number} propVal - the property value\n */\nexport const recalcTotal = (o, propVal) => ({\n  orderTotal: calcTotal(propVal)\n})\n\n/**\n * Updated signature requirement if `orderTotal` above certain value\n * @param {object} o - the object (order)\n * @param {number} propVal - the property value\n */\nexport const updateSignature = (o, propVal) => ({\n  signatureRequired: calcTotal(propVal) > 999.99 || o.signatureRequired\n})\n\n/**\n * Don't delete orders before they're complete.\n */\nexport function readyToDelete (model) {\n  if (\n    ![OrderStatus.COMPLETE, OrderStatus.CANCELED].includes(model.orderStatus)\n  ) {\n    throw new Error('order must be canceled or completed')\n  }\n  return model\n}\n\n/**\n *\n * @param {Error} error\n * @param {Order} order\n * @param {*} func\n */\nfunction handleError (error, order, func) {\n  const errMsg = { func, orderNo: order.orderNo, error }\n  if (order) order.emit('orderError', errMsg)\n\n  throw new Error(JSON.stringify(errMsg))\n}\n\n/**\n * Callback invoked by adapter when payment is complete\n * @param {{model:Order}} options\n */\nexport async function paymentCompleted (options = {}, payload = {}) {\n  const { model: order } = options\n  const changes = checkPayload(\n    'confirmationCode',\n    options,\n    payload,\n    paymentCompleted.name\n  )\n  return order.update({ ...changes, orderStatus: OrderStatus.COMPLETE })\n}\n\n/**\n * Callback invoked by shipping adapter when order is picked up.\n * @param {{model:Order}} options\n * @param {string} shipmentId\n */\nexport async function orderShipped (options = {}, payload = {}) {\n  const { model: order } = options\n  const shipmentPayload = checkPayload(\n    'shipmentId',\n    options,\n    payload,\n    orderShipped.name\n  )\n  return order.update({\n    shipmentId: shipmentPayload.shipmentId,\n    orderStatus: OrderStatus.SHIPPING\n  })\n}\n\n/**\n * Callback invoked when order is ready for pickup\n * @param {{ model:Order }} options\n */\nexport async function orderPicked (options = {}, payload = {}) {\n  const { model: order } = options\n  const changes = checkPayload(\n    'pickupAddress',\n    options,\n    payload,\n    addressValidated.name\n  )\n  return order.update(changes)\n}\n\n/**\n * Callback invoked when shippingAddress is verified (and possibly corrected)\n * @param {{ model:Order }} options\n * @param {string} shippingAddress\n */\nexport async function addressValidated (options = {}, payload = {}) {\n  const { model: order } = options\n  const addressPayload = checkPayload(\n    'shippingAddress',\n    options,\n    payload,\n    addressValidated.name\n  )\n  return order.update({ shippingAddress: addressPayload.shippingAddress })\n}\n\n/**\n * Called by adapter when port recevies response from payment service.\n * @param {{ model:Order }} options\n * @param {*} paymentAuthorization\n */\nexport async function paymentAuthorized (options = {}, payload = {}) {\n  const { model: order } = options\n  const changes = checkPayload(\n    'paymentStatus',\n    options,\n    payload,\n    paymentAuthorized.name\n  )\n  return order.update({ ...changes, paymentStatus }, false)\n}\n\n/**\n * Called to refund payment when order is canceled.\n * @param {*} options\n * @param {*} payload\n * @returns\n */\nexport async function refundPayment (order) {\n  // call port by same name.\n  order.refundPayment((options, payload) => {\n    const changes = checkPayload(\n      'refundReceipt',\n      options,\n      payload,\n      refundPayment.name\n    )\n    return order.update({ ...changes, orderStatus: OrderStatus.CANCELED })\n  })\n}\n\n/**\n *\n * @param {Order} order\n * @returns {Promise<Order>}\n */\nasync function verifyAddress (order) {\n  console.debug({\n    fn: verifyAddress.name,\n    validateAddress: order.validateAddress\n  })\n  return order.validateAddress(addressValidated)\n}\n\n/**\n * Request the bank or lender to place a hold on\n * the customer account in the amount of the payment\n * due, to be withdrawn once the shipment is safely\n * in our customer's hands, or credited back if things\n * don't work out.\n *\n * @param {Order} order\n * @returns {Promise<Order>}\n */\nasync function verifyPayment (order) {\n  try {\n    /**\n     * @type {Order}\n     */\n    const authorizeOrder = await order.authorizePayment(paymentAuthorized)\n\n    if (!authorizeOrder.paymentDeclined) {\n      throw new Error('payment declined')\n    }\n\n    return authorizeOrder\n  } catch (e) {\n    handleError(e, order, verifyPayment.name)\n  }\n  return order\n}\n\n/**\n *\n * @param {Order} order\n * @returns {Promise<Order>}\n * @throws {'oInventory'}\n */\nasync function verifyInventory (order) {\n  const inventory = await order.inventory()\n  if (inventory.length < 1) throw new Error('bad inventory ID')\n\n  const insufficient = order.orderItems.filter(item => {\n    const inv = inventory.find(i => i.id === item.itemId)\n    if (!inv) return true\n    if (inv.quantity < item.qty) return true\n    return false\n  })\n\n  if (insufficient.length > 0) {\n    order.emit('lowOrOutOfStock', insufficient)\n    throw new Error(`low or out of stock: ${insufficient.map(i => i.itemId)}`)\n  }\n}\n/**\n * Copy existing customer data into the order\n * or create new customer from order details.\n *\n * @param {Order} order\n * @throws {'InvalidCustomerId'}\n */\nasync function getCustomerOrder (order) {\n  // If an id is given, try fetching the model\n  if (order.customerId) {\n    if (!order.customer) {\n      console.log({ order })\n    }\n    // Use the relation defined in the spec\n    const customer = await order.customer()\n\n    if (!customer) {\n      throw new Error('invalid customer id', order.customerId)\n    }\n\n    // Add customer data to the order\n    const custInfo = { ...customer.decrypt(), firstName: customer.firstName }\n    const update = await order.update(custInfo)\n\n    console.info('update order with data from existing customer', custInfo)\n    return update\n  }\n\n  // Create a new customer from the shipping details\n  if (order.saveShippingDetails) {\n    const custInfo = { ...order.decrypt(), firstName: order.firstName }\n    const customer = await order.customer(custInfo)\n\n    console.info('create new customer with data from order', customer)\n    return order\n  }\n\n  return order\n}\n\n/**\n * Handle a new order:\n * - fetch or save customer info\n * - check item availability\n * - authorize payment\n * - verify shipping address\n */\nconst processPendingOrder = asyncPipe(\n  getCustomerOrder,\n  verifyInventory,\n  verifyPayment,\n  verifyAddress\n)\n\n/**\n * Implements the beginging of the order service workflow.\n * The rest is implemented by the {@link ModelSpecification}.\n * See the port configuration section of {@link Order}.\n */\nconst OrderActions = {\n  /**\n   * Verifies the shipping address and authorizes payment\n   * for the order total when the order is first created,\n   * or when it is updated while still in pending status.\n   *\n   * @param {Order} order - the order\n   * @returns {Promise<Readonly<Order>>}\n   */\n  [OrderStatus.PENDING]: order => {\n    // return processPendingOrder(order)\n\n    if (order.autoCheckout)\n      /**@type {Order} */\n      getCustomerOrder(order).then(order =>\n        runOrderWorkflow(\n          order.updateSync({ orderStatus: OrderStatus.APPROVED })\n        )\n      )\n  },\n\n  /**\n   * If payment is authorized, check inventory.\n   * This kicks off the rest of the workflow,\n   * which is controlled by port event flow.\n   * @param {Order} order\n   * @returns {Promise<Readonly<Order>>}\n   */\n  [OrderStatus.APPROVED]: order => {\n    try {\n      //if (/approved/i.test(order.paymentStatus))\n      return order.pickOrder(orderPicked)\n\n      // order.emit('PayAuthFail', 'Payment authorization problem')\n      // return order\n    } catch (error) {\n      console.log({ error })\n      handleError(error, order, OrderStatus.APPROVED)\n    }\n    return order\n  },\n\n  /**\n   * Useful if we need to restart tracking.\n   * @param {Order} order\n   * @returns {Promise<Readonly<Order>>}\n   */\n  [OrderStatus.SHIPPING]: async order => {\n    try {\n      order.trackShipment(trackingUpdate)\n      console.debug({ func: OrderStatus.SHIPPING, order })\n      await (await order.update({ orderStatus: OrderStatus.SHIPPING })).emit(\n        'orderPicked'\n      )\n    } catch (error) {\n      handleError(error, order, OrderStatus.SHIPPING)\n    }\n    return order\n  },\n\n  /**\n   * Start cancellation process.\n   * @param {Order} order\n   * @returns {Promise<Readonly<Order>>}\n   */\n  [OrderStatus.CANCELED]: async order => {\n    try {\n      console.debug({\n        func: OrderStatus.CANCELED,\n        desc: 'order canceled, calling undo',\n        orderNo: order.orderNo\n      })\n      return order.undo()\n    } catch (error) {\n      handleError(error, order, OrderStatus.CANCELED)\n    }\n    return order\n  },\n  /**\n   *\n   * @param {Order} order\n   * @returns {Promise<Readonly<Order>>}\n   */\n  [OrderStatus.COMPLETE]: async order => {\n    // send route to questionnaire, perform analysis, schedule follow-up\n    console.log('customer sentiment analysis, customer care, sales analysis')\n    return order\n  }\n}\n\n/**\n * Call order service workflow - controlled by status\n * @param {Order} order\n * @returns {Promise<Readonly<Order>>}\n */\nexport function runOrderWorkflow (order) {\n  console.log({ orderStatus: order.orderStatus })\n  OrderActions[order.orderStatus](order)\n}\n\n/**\n * Called on create, update, delete of model instance.\n * @param {{model:Promise<ReadOnly<Order>>}}\n */\nexport function handleOrderEvent ({ model: order, eventType, changes }) {\n  if (changes?.orderStatus || eventType === 'CREATE') {\n    // console.debug({ fn: handleOrderEvent.name, order })\n    runOrderWorkflow(order)\n  }\n}\n\n/**\n * Require a signature for orders $1000 and up\n * @param {*} input\n * @param {*} orderTotal\n */\nfunction needsSignature (input, orderTotal) {\n  return typeof input === 'boolean' ? input : orderTotal > 999.99\n}\n\n/** format and classify log entries */\nfunction logMessage (message, type) {\n  const msg = typeof message === 'string' ? message : JSON.stringify(message)\n\n  return {\n    desc: msg.substring(0, 140),\n    type,\n    time: Date.now(),\n    toJSON () {\n      return {\n        desc: this.desc,\n        type,\n        time: new Date(this.time).toISOString()\n      }\n    }\n  }\n}\n\n/**\n * Returns factory function for the Order model.\n * @type {import('../domain/index.js').modelSpecFactoryFn}\n * @param {*} dependencies - inject dependencies\n */\nexport function makeOrderFactory (dependencies) {\n  return function createOrder ({\n    orderItems,\n    email = null,\n    lastName = null,\n    firstName = null,\n    customerId = null,\n    billingAddress = null,\n    shippingAddress = null,\n    creditCardNumber = null,\n    shippingPriority = null,\n    autoCheckout = false,\n    saveShippingDetails = false,\n    requireSignature,\n    fibonacci = 10\n  }) {\n    //const signatureRequired = needsSignature(requireSignature, total)\n    const order = {\n      email,\n      lastName,\n      firstName,\n      customerId,\n      orderItems,\n      creditCardNumber,\n      billingAddress,\n      shippingAddress,\n      signatureRequired: false,\n      saveShippingDetails,\n      shippingPriority,\n      fibonacci,\n      result: 0,\n      time: 0,\n      estimatedArrival: null,\n      log: [logMessage('order created')],\n      [orderTotal]: 0,\n      [orderStatus]: OrderStatus.PENDING,\n      [orderNo]: dependencies.uuid(),\n      desc: 'new order 25',\n      itemId: null,\n      /**\n       * Has payment for the order been authorized?\n       */\n      paymentAccepted () {\n        return true\n      },\n      /**\n       * Proceed to checkout automatically or wait for approval?\n       */\n      autoCheckout () {\n        return autoCheckout\n      },\n      totalItems () {\n        return itemCount(this.orderItems)\n      },\n      total () {\n        return calcTotal(this.orderItems)\n      },\n      addItem (item) {\n        if (checkItem(item)) {\n          this.orderItems.push(item)\n          return true\n        }\n        return false\n      },\n      logEvent (message, type = 'info') {\n        this.log.push(logMessage(message, type))\n      },\n      logError (message) {\n        this.logEvent(message, 'error')\n      },\n      logUndo (message) {\n        this.logEvent(message, 'undo')\n      },\n      logStateChange (message) {\n        this.logEvent(message, 'stateChange')\n      },\n\n      /**\n       *\n       * @param {viewLog} options\n       * @returns {logMessageFn[]|logMessageFn}\n       */\n      readLog ({ index = null, type = null }) {\n        const indx = parseInt(index)\n        if (indx < this.log.length && indx !== NaN) return this.log[indx]\n        if (type === 'first') return this.log[0]\n        if (type === 'last') return this.log[this.log.length - 1]\n        if (type === 'lastStateChange')\n          return this.log[this.log.lastIndexOf({ type: 'stateChange' })]\n        if (type === 'stateChanges')\n          return this.log.filter(l => l.type === 'stateChange')\n        if (type === 'error') return this.log.filter(l => l.type === 'error')\n        if (type === 'undo') return this.log.filter(l => l.type === 'undo')\n        return this.log\n      }\n    }\n\n    return Object.freeze(order)\n  }\n}\n\n/**\n * Called as command to approve/submit order.\n * @param {Order} order\n */\nexport async function approve (order) {\n  console.debug({ msg: 'got order', order })\n  const approvedOrder = order.updateSync(\n    {\n      orderStatus: OrderStatus.APPROVED\n    },\n    false\n  )\n  console.debug({ approvedOrder })\n  approvedOrder.logStateChange(OrderStatus.APPROVED)\n  return runOrderWorkflow(approvedOrder)\n}\n\n/**\n * Called as command to cancel order.\n * @param {Order} order\n */\nexport async function cancel (order) {\n  const canceledOrder = await order.update({\n    orderStatus: OrderStatus.CANCELED\n  })\n  canceledOrder.logStateChange(OrderStatus.CANCELED)\n  return runOrderWorkflow(canceledOrder)\n}\n\n/**\n * Alias of `approve`\n * @param {Order} order\n * @returns\n */\nexport async function checkout (order) {\n  return approve(order)\n}\n\n/**\n *\n * @param {{model:Order}} param0\n */\nexport function errorCallback ({ port, model: order, error }) {\n  const errMsg = { error, port, error }\n  console.error(errorCallback.name, errMsg)\n  order.logEvent(errMsg)\n  order.emit(errorCallback.name, errMsg)\n  return order.undo()\n}\n\n/**\n *\n * @param {{model:Order}} param0\n */\nexport function timeoutCallback ({ port, ports, adapterFn, model: order }) {\n  console.error('timeout...', port)\n  //order.logError(timeoutCallback.name, 'timeout')\n  order.emit(timeoutCallback.name, errMsg)\n}\n\n/**\n * @type {undoFunction}\n * Start process to return canceled order items to inventory.\n * Do not call `runOrderWorkflow` - it is already running (in\n * reverse) if we get here.\n */\nexport async function returnInventory (order) {\n  console.log(returnInventory.name)\n  order.logEvent(returnInventory.name, 'timeout')\n  order.emit(returnInventory.name, errMsg)\n  return order.update({ orderStatus: OrderStatus.CANCELED })\n}\n\n/**\n * @type {undoFunction}\n * Start process for the shipper to pick the items to return.\n * Do not call `runOrderWorkflow` - it is already running (in\n * reverse) if we get here.\n */\nexport async function returnShipment (order) {\n  console.log(returnShipment.name)\n  order.logUndo(returnShipment.name)\n  return order.update({ orderStatus: OrderStatus.CANCELED })\n}\n\nexport function accountOrder (req, res) {}\n1\n/**\n * @type {undoFunction}\n * Start process to return canceled order items to inventory.\n * Do not call `runOrderWorkflow` - it is already running (in\n * reverse) if we get here.\n */\nexport async function returnDelivery (order) {\n  console.log(returnDelivery.name)\n  return order.update({ orderStatus: OrderStatus.CANCELED })\n}\n\n/**\n * @type {undoFunction}\n */\nexport async function cancelPayment (order) {\n  console.log(cancelPayment.name)\n  return order.update({ orderStatus: OrderStatus.CANCELED })\n}\n\nexport class OrderError extends Error {\n  constructor (error, code) {\n    super(error)\n    this.code = code\n  }\n}\n\n/**\n *\n * @param {Date.now} data\n * @returns\n */\nexport async function cancelOrders (data) {\n  const cancelOrdersTransform = new Transform({\n    objectMode: true,\n    transform: (chunk, _encoding, done) => {\n      if (chunk._id) delete chunk._id\n      done(\n        null,\n        JSON.stringify({ ...chunk, orderStatus: OrderStatus.CANCELED })\n      )\n    }\n  })\n\n  await this.list({\n    writable: this.createWriteStream(),\n    transform: cancelOrdersTransform,\n    serialize: false\n  })\n\n  return { status: 'ok' }\n}\n\n/**\n *\n * @param {Date.now} data\n * @returns\n */\n\nexport async function approveOrders (data) {\n  try {\n    console.log(x)\n  } catch (error) {\n    throw new OrderError(error, 401)\n  }\n\n  const approveOrdersTransform = new Transform({\n    objectMode: true,\n    transform: (chunk, _encoding, done) => {\n      if (chunk._id) delete chunk._id\n      done(\n        null,\n        JSON.stringify({ ...chunk, orderStatus: OrderStatus.APPROVED })\n      )\n    }\n  })\n\n  await this.list({\n    writable: this.createWriteStream(),\n    transform: approveOrdersTransform,\n    serialize: false\n  })\n\n  return { status: 'ok' }\n}\n\n/**\n *\n * @returns\n */\nexport async function trackAsyncContext () {\n  const ctx = this.getContext()\n  const dur = 'test-duration'\n  const startTime = Date.now()\n\n  await new Promise(resolve => setTimeout(resolve, 100))\n\n  // require('fs')\n  //   .stream('/etc/hosts')\n  //   .pipe(ctx.get('res'))\n\n  ctx.set(dur, Date.now() - startTime)\n\n  const metric = {\n    requestId: ctx.get('id'),\n    fn: trackAsyncContext.name,\n    duration: ctx.get(dur),\n    context: [...ctx]\n  }\n\n  this.emit('metric', metric)\n  console.log(metric.ctx)\n\n  return metric\n}\n\nexport async function customHttpStatus (data) {\n  if (data.args.code)\n    throw new OrderError(data.args.message || 'custom status', data.args.code)\n  try {\n    console.log(x)\n  } catch (error) {\n    throw new OrderError(error, 500)\n  }\n}\n\nexport async function testContainsMany (data) {\n  this.chat()\n  return { status: 'ok' }\n}\n\nfunction fibonacci (x) {\n  if (x === 0) {\n    return 0\n  }\n  if (x === 1) {\n    return 1\n  }\n  return fibonacci(x - 1) + fibonacci(x - 2)\n}\n\nexport async function runFibonacciJs (data) {\n  console.log({ data })\n  const param = parseInt(data.args.fibonacci || 20)\n  const start = Date.now()\n  return {\n    fibonacci: param,\n    result: fibonacci(param),\n    time: Date.now() - start\n  }\n}\n","import { systemsInGalaxy } from './SolarSystem'\n\nexport {\n  cancelOrders,\n  approveOrders,\n  trackAsyncContext,\n  customHttpStatus,\n  testContainsMany,\n  runFibonacciJs\n} from './order'\nexport { listSolarSystems, sendGalaticSignal } from './Galaxy'\nexport {\n  systemsInGalaxy,\n  sendSolarSignal,\n  receiveGalacticSignal\n} from './SolarSystem'\nexport { receiveSolarSignal, planetsInSolarSystem } from './Planet'\nexport {\n  qeRunFibonacci,\n  qeCustomHttpStatus,\n  qeGetPublicIpAddressIn\n} from './query-engine'\n","class QeError extends Error {\n  constructor (message, code) {\n    super(message)\n    this.code = code\n  }\n}\n\nfunction fibonacci (x) {\n  if (x === 0) {\n    return 0\n  }\n  if (x === 1) {\n    return 1\n  }\n  return fibonacci(x - 1) + fibonacci(x - 2)\n}\n\nexport async function qeRunFibonacci (data) {\n  console.log({ data })\n  const param = parseInt(data.args.fibonacci || 20)\n  const start = Date.now()\n  return {\n    fibonacci: param,\n    result: fibonacci(param),\n    time: Date.now() - start\n  }\n}\n\nexport async function qeCustomHttpStatus (data) {\n  throw new QeError(`custom http status ${data.args.code}`, data.args.code)\n}\n\nexport async function qeGetPublicIpAddressIn (data) {\n  try {\n    return this.qeGetPublicIpAddressOut()\n  } catch (error) {\n    throw new QeError(error, 500)\n  }\n}\n","'use strict'\n\nimport crypto from 'crypto'\nimport { nanoid } from 'nanoid'\n\nexport function compose (...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight((val, func) => func(val), initVal)\n  }\n}\n\nexport function composeAsync (...funcs) {\n  return function (initVal) {\n    return funcs.reduceRight(\n      (val, func) => val.then(func),\n      Promise.resolve(initVal)\n    )\n  }\n}\n\n/**\n * @callback pipeFn\n * @param {object} obj - the object to compose\n * @returns {object} - the composed object\n */\n\n/**\n * @param {pipeFn} func\n */\nexport const asyncPipe = (...func) => obj =>\n  func.reduce((o, f) => o.then(f), Promise.resolve(obj))\n\nconst passwd = process.env.ENCRYPTION_PWD\nconst algo = 'aes-192-cbc'\nconst key = crypto.scryptSync(String(passwd), 'salt', 24)\nconst iv = Buffer.alloc(16, 0)\n\nexport function encrypt (text) {\n  const cipher = crypto.createCipheriv(algo, key, iv)\n  let encrypted = cipher.update(text, 'utf8', 'hex')\n  encrypted += cipher.final('hex')\n  return encrypted\n}\n\nexport function decrypt (cipherText) {\n  console.log('decrypt(%s)', cipherText)\n  const decipher = crypto.createDecipheriv(algo, key, iv)\n  let decrypted = decipher.update(cipherText, 'hex', 'utf8')\n  decrypted += decipher.final('utf8')\n  return decrypted\n}\n\nexport function hash (data) {\n  return crypto\n    .createHash('sha1')\n    .update(data)\n    .digest('hex')\n}\n\nexport function uuid () {\n  // return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n  //   (c ^ (crypto.randomBytes(16)[0] & (15 >> (c / 4)))).toString(16)\n  // );\n  return nanoid()\n}\n\nexport function makeArray (v) {\n  return Array.isArray(v) ? v : [v]\n}\n\nexport function makeObject (prop) {\n  if (Array.isArray(prop)) {\n    return prop.reduce((p, c) => ({ ...p, ...c }))\n  }\n  return prop\n}\n\n/**\n *\n * @param {Promise<{\n * ok:()=>any,\n *\n * }} promise\n * @returns\n */\nexport function async (promise) {\n  return promise\n    .then(result => ({\n      ok: true,\n      object: result,\n      asObject: () => makeObject(result),\n      asArray: () => makeArray(result)\n    }))\n    .catch(error => {\n      console.error(error)\n      return Promise.resolve({ ok: false, error })\n    })\n}\n"],"sourceRoot":""}